"use strict";(self.webpackChunkcadviewer=self.webpackChunkcadviewer||[]).push([["src_components_SelectVersionModal_vue"],{6921:(e,i,t)=>{t.d(i,{Z:()=>a});var r=t(7537),n=t.n(r),o=t(3645),s=t.n(o)()(n());s.push([e.id,".version[data-v-15737242]{display:flex;flex-direction:row;cursor:pointer;padding:8px;border-radius:8px;margin:4px 8px}.version.disabled[data-v-15737242]{cursor:not-allowed}.version.disabled *[data-v-15737242]{cursor:not-allowed !important}.version.disabled[data-v-15737242]:hover{background-color:rgba(0,0,0,0) !important}.version[data-v-15737242]:hover{background-color:var(--color-background-hover)}.version__content[data-v-15737242]{flex:1 1 auto;width:0;margin:auto 0;padding-left:8px;cursor:pointer}.version__title[data-v-15737242]{font-weight:bold;text-overflow:ellipsis;color:var(--color-main-text);cursor:pointer}.version__info[data-v-15737242]{display:flex;flex-direction:row;align-items:center;gap:.5rem;text-overflow:ellipsis;color:var(--color-text-maxcontrast);cursor:pointer}.version__info__size[data-v-15737242]{color:var(--color-text-lighter);cursor:pointer}.version__image[data-v-15737242]{width:3rem;height:3rem;border:1px solid var(--color-border);border-radius:var(--border-radius-large);display:flex;justify-content:center;color:var(--color-text-light);cursor:pointer}","",{version:3,sources:["webpack://./src/components/FileVersion.vue"],names:[],mappings:"AACA,0BACC,YAAA,CACA,kBAAA,CACG,cAAA,CACA,WAAA,CACA,iBAAA,CACA,cAAA,CAEA,mCACI,kBAAA,CACA,qCACI,6BAAA,CAGR,yCACI,yCAAA,CAGJ,gCACI,8CAAA,CAGJ,mCACI,aAAA,CACA,OAAA,CACA,aAAA,CACA,gBAAA,CACA,cAAA,CAEJ,iCACI,gBAAA,CACA,sBAAA,CACA,4BAAA,CACA,cAAA,CAGP,gCACC,YAAA,CACA,kBAAA,CACA,kBAAA,CACA,SAAA,CACM,sBAAA,CACA,mCAAA,CAEA,cAAA,CACN,sCACC,+BAAA,CACS,cAAA,CAIX,iCACC,UAAA,CACA,WAAA,CACA,oCAAA,CACA,wCAAA,CAGA,YAAA,CACA,sBAAA,CACA,6BAAA,CACM,cAAA",sourcesContent:["\n.version {\n\tdisplay: flex;\n\tflex-direction: row;\n    cursor: pointer;\n    padding: 8px;\n    border-radius: 8px;\n    margin: 4px 8px;\n\n    &.disabled {\n        cursor: not-allowed;   \n        *  {\n            cursor: not-allowed  !important; \n        }\n    }\n    &.disabled:hover {\n        background-color: transparent !important;\n    }\n\n    &:hover {\n        background-color: var(--color-background-hover);\n    }\n\n    &__content {\n        flex: 1 1 auto;\n        width: 0;\n        margin: auto 0;\n        padding-left: 8px;\n        cursor: pointer;\n    }\n    &__title {\n        font-weight: bold;\n        text-overflow: ellipsis;\n        color: var(--color-main-text);\n        cursor: pointer;\n    }\n\n\t&__info {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tgap: 0.5rem;\n        text-overflow: ellipsis;\n        color: var(--color-text-maxcontrast);\n\n        cursor: pointer;\n\t\t&__size {\n\t\t\tcolor: var(--color-text-lighter);\n            cursor: pointer;\n\t\t}\n\t}\n\n\t&__image {\n\t\twidth: 3rem;\n\t\theight: 3rem;\n\t\tborder: 1px solid var(--color-border);\n\t\tborder-radius: var(--border-radius-large);\n\n\t\t// Useful to display no preview icon.\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tcolor: var(--color-text-light); \n        cursor: pointer;\n\t}\n}\n"],sourceRoot:""}]);const a=s},4448:(e,i,t)=>{t.d(i,{Z:()=>a});var r=t(7537),n=t.n(r),o=t(3645),s=t.n(o)()(n());s.push([e.id,".modal__title[data-v-527ae786]{text-overflow:ellipsis;color:var(--color-main-text);font-size:20px;font-weight:bold;margin:8px 20px}","",{version:3,sources:["webpack://./src/components/SelectVersionModal.vue"],names:[],mappings:"AACA,+BACI,sBAAA,CACA,4BAAA,CACA,cAAA,CACA,gBAAA,CACA,eAAA",sourcesContent:["\n.modal__title {\n    text-overflow: ellipsis;\n    color: var(--color-main-text);\n    font-size: 20px;\n    font-weight: bold;\n    margin: 8px 20px;\n}\n"],sourceRoot:""}]);const a=s},5610:(e,i,t)=>{t.d(i,{default:()=>G});var r=function(){var e=this,i=e._self._c;e._self._setupProxy;return i("NcModal",{attrs:{size:"small",show:e.opened},on:{close:e.onCancel}},[i("div",[i("div",{staticClass:"modal__header"},[i("div",{staticClass:"modal__title"},[e._v("\n                    Select version to compare with\n                ")])]),e._v(" "),i("ul",{attrs:{"data-files-versions-versions-list":""}},e._l(e.orderedVersions,(function(t){return i("FileVersion",{key:t.mtime,attrs:{"load-preview":e.isActive,version:t,"file-info":e.file,"is-first-version":t.mtime==e.initialVersionMtime},on:{compare:e.compareVersion}})})),1)])])};r._withStripped=!0;var n=t(144),o=t(110),s=t.n(o),a=t(9753),l=function(){var e=this,i=e._self._c;return i("div",[i("div",{class:["version",e.isCurrent?"disabled":""],on:{click:e.compareVersion}},[i("div",[e.loadPreview||e.previewLoaded?!e.isCurrent&&!e.version.hasPreview||e.previewErrored?i("div",{staticClass:"version__image"},[i("ImageOffOutline",{attrs:{size:20}})],1):i("img",{staticClass:"version__image",attrs:{src:e.version.previewUrl,alt:"",decoding:"async",fetchpriority:"low",loading:"lazy"},on:{load:function(i){e.previewLoaded=!0},error:function(i){e.previewErrored=!0}}}):i("div",{staticClass:"version__image"})]),e._v(" "),i("div",{staticClass:"version__content"},[i("div",{staticClass:"version__title"},[e._v("\n                    "+e._s(e.versionLabel)+"\n                ")]),e._v(" "),i("div",{staticClass:"version__info"},[i("span",{attrs:{title:e.formattedDate}},[e._v(e._s(e._f("humanDateFromNow")(e.version.mtime)))]),e._v(" "),i("span",{staticClass:"version__info__size"},[e._v("â€¢")]),e._v(" "),i("span",{staticClass:"version__info__size"},[e._v(e._s(e._f("humanReadableSize")(e.version.size)))])])])])])};l._withStripped=!0;var A=t(1368),d=t(7883),c=t(1352),m=t(3554),v=t(5108);const p={name:"Version",components:{ImageOffOutline:A.Z},filters:{humanReadableSize:e=>OC.Util.humanFileSize(e),humanDateFromNow:e=>(0,d.Z)(e).fromNow()},props:{version:{type:Object,required:!0},fileInfo:{type:Object,required:!0},isFirstVersion:{type:Boolean,default:!1},loadPreview:{type:Boolean,default:!1}},data(){return{previewLoaded:!1,previewErrored:!1,formVersionLabelValue:this.version.label,capabilities:(0,m.j)("core","capabilities",{files:{version_labeling:!1,version_deletion:!1}})}},mounted(){v.log({version:this.version,fileInfo:this.fileInfo,isCurrent:this.isCurrent,isFirstVersion:this.isFirstVersion,versionLabel:this.versionLabel})},computed:{isCurrent(){return this.version.mtime==(this.fileInfo.mtime.getTime?this.fileInfo.mtime.getTime():this.fileInfo.mtime)},versionLabel(){var e;const i=null!==(e=this.version.label)&&void 0!==e?e:"";return this.isCurrent?""===i?"Current version":"".concat(i," (Current version)"):this.isFirstVersion&&""===i?"Initial version":i},formattedDate(){return(0,d.Z)(this.version.mtime).format("LLL")}},methods:{compareVersion(){this.isCurrent||this.$emit("compare",{version:this.version})},t:c.Iu}};var u=t(3379),f=t.n(u),C=t(7795),h=t.n(C),g=t(569),_=t.n(g),b=t(3565),x=t.n(b),w=t(9216),y=t.n(w),I=t(4589),V=t.n(I),B=t(6921),L={};L.styleTagTransform=V(),L.setAttributes=x(),L.insert=_().bind(null,"head"),L.domAPI=h(),L.insertStyleElement=y();f()(B.Z,L);B.Z&&B.Z.locals&&B.Z.locals;var k=t(1900);const Z=(0,k.Z)(p,l,[],!1,null,"15737242",null).exports;var z,T=t(6470),M=t.n(T),S=t(4596),R=t(4855),E=t(5358);const U=(0,t(7499).IY)().setApp("demo").detectUser().build(),F=(0,S.eI)((0,a.generateRemoteUrl)("dav"),{headers:{"X-Requested-With":"XMLHttpRequest",requesttoken:null!==(z=(0,R.IH)())&&void 0!==z?z:""}});function P(e){const i=(e.startsWith("/")?e:"/".concat(e)).split("/");let t="";return i.forEach((e=>{""!==e&&(t+="/"+encodeURIComponent(e))})),t}async function O(e){var i;const t="/versions/".concat(null===(i=(0,R.ts)())||void 0===i?void 0:i.uid,"/versions/").concat(e.fileid||e.id);try{return(await F.getDirectoryContents(t,{data:'<?xml version="1.0"?>\n                <d:propfind xmlns:d="DAV:"\n                    xmlns:oc="http://owncloud.org/ns"\n                    xmlns:nc="http://nextcloud.org/ns"\n                    xmlns:ocs="http://open-collaboration-services.org/ns">\n                    <d:prop>\n                        <d:getcontentlength />\n                        <d:getcontenttype />\n                        <d:getlastmodified />\n                        <d:getetag />\n                        <nc:version-label />\n                        <nc:has-preview />\n                    </d:prop>\n                </d:propfind>',details:!0})).data.filter((e=>{let{mime:i}=e;return""!==i})).map((i=>function(e,i){const t=1e3*(0,d.Z)(e.lastmod).unix();let r="",n="";var o,s;return t===i.mtime?(n=M().join("files",null!==(o=null===(s=(0,R.ts)())||void 0===s?void 0:s.uid)&&void 0!==o?o:"",i.path),r=(0,a.generateUrl)("/core/preview?fileId={fileId}&c={fileEtag}&x=250&y=250&forceIcon=0&a=0",{fileId:i.fileid,fileEtag:(i.attributes||i._attributes).etag})):(n=e.filename,r=(0,a.generateUrl)("/apps/files_versions/preview?file={file}&version={fileVersion}",{file:i.path,fileVersion:e.basename})),{fileId:i.fileid||i.id,label:e.props["version-label"],filename:n,basename:(0,d.Z)(t).format("LLL"),mime:e.mime,etag:"".concat(e.props.getetag),size:e.size,type:e.type,mtime:t,permissions:"R",hasPreview:1===e.props["has-preview"],previewUrl:r,url:(0,E.RQ)("/remote.php/dav",n),source:(0,a.generateRemoteUrl)("dav")+P(n),fileVersion:e.basename}}(i,e)))}catch(e){throw U.error("Could not fetch version",{exception:e}),e}}const q=n.ZP.extend({name:"SelectVersionModal",components:{NcModal:s(),FileVersion:Z},props:{file:{required:!0}},data:()=>({isActive:!1,versions:[],opened:!0,loading:!1}),computed:{orderedVersions(){return[...this.versions].sort(((e,i)=>e.mtime===(this.file.mtime.getTime?this.file.mtime.getTime():this.file.mtime)?-1:i.mtime===(this.file.mtime.getTime?this.file.mtime.getTime():this.file.mtime)?1:i.mtime-e.mtime))},initialVersionMtime(){return this.versions.map((e=>e.mtime)).reduce(((e,i)=>Math.min(e,i)))}},async beforeMount(){this.versions=await O(this.file)},methods:{onCancel(){this.opened=!1,this.$emit("cancel")},versionLabel(e){const i=e.label??"";return e.mtime==(this.file.mtime.getTime?this.file.mtime.getTime():this.file.mtime)?""===i?"Current version":`${i} (Current version)`:e.mtime==this.initialVersionMtime&&""===i?"Initial version":i},compareVersion({version:e}){const i=this.versions.findLast((e=>e.mtime==(this.file.mtime.getTime?this.file.mtime.getTime():this.file.mtime)));this.$emit("select",{version:e,firstLabel:this.versionLabel(e),currentVersion:this.versionLabel(i)})},async fetchVersions(){try{this.loading=!0,this.versions=await O(this.file)}finally{this.loading=!1}}}});var j=t(4448),D={};D.styleTagTransform=V(),D.setAttributes=x(),D.insert=_().bind(null,"head"),D.domAPI=h(),D.insertStyleElement=y();f()(j.Z,D);j.Z&&j.Z.locals&&j.Z.locals;const G=(0,k.Z)(q,r,[],!1,null,"527ae786",null).exports}}]);
//# sourceMappingURL=cadviewer-src_components_SelectVersionModal_vue.js.map?v=a78b213ee4f77c4931ad